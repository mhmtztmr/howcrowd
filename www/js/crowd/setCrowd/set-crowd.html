<ons-page>
  <ons-toolbar>
    <div class="left">
      <ons-toolbar-button ng-click="menu.toggle()">
        <ons-icon icon="ion-navicon" size="28px" fixed-width="false"></ons-icon>
      </ons-toolbar-button>
    </div>
    <div class="center">{{$root.lang.MAIN_MENU.SET_CROWD}}</div>
  </ons-toolbar>

  <button ng-if="!nearbyPlaces" class="refresh-button button button--quiet" ng-click="checkLocation()">{{$root.lang.SET_CROWD_MENU.NO_LOCATION}}</button>

  <div ng-if="nearbyPlaces === 'pending'" class="loading-gif-wrapper">
    <div class="loading-gif-inner">
      <div class="sp sp-wave"></div>
    </div>
  </div>

  <div ng-if="nearbyPlaces && nearbyPlaces !== 'pending'" style="height: 100%;">
    <button ng-if="nearbyPlaces.length === 0" class="refresh-button button button--quiet" ng-click="selectPlace()">{{$root.lang.SET_CROWD_MENU.NO_PLACE}}</button>
    <div ng-if="nearbyPlaces.length > 0">
      <div class="tab-bar">
        <label class="tab-bar__item"  ng-click="selectPlace()">
          <input type="radio" name="tab-bar-c" checked="checked">
          <button class="tab-bar__button">
            <div class="tab-bar__label">{{$root.lang.SET_CROWD_MENU.ENTER_CUSTOM_PLACE}}</div>
          </button>
        </label>
      </div>
      <ons-list modifier="inset">
        <ons-list-item ng-repeat="place in nearbyPlaces" ng-click="selectPlace(place)">{{place.name}}</ons-list-item>
      </ons-list>
    </div>

    <ons-template id="crowd-level.html">
      <ons-dialog var="dialog" cancelable ng-controller="setCrowdDialogController">
        <ons-toolbar inline ng-if="selectedPlace !== undefined">
          <div class="center">
            {{selectedPlace.name}}
          </div>
        </ons-toolbar>

        <input ng-if="selectedPlace === undefined" style="width:100%; height:3em" type="text" placeholder="{{$root.lang.SET_CROWD_MENU.PLACE_NAME}}" ng-model="$parent.customPlaceName" class="text-input text-input--underbar" />

        <ons-list>
          <ons-list-item modifier="tappable" ng-click="insertCrowd(100, customPlaceName); dialog.hide()">
            100%
          </ons-list-item>
          <ons-list-item modifier="tappable" ng-click="insertCrowd(80, customPlaceName);dialog.hide()">
            80%
          </ons-list-item>
          <ons-list-item modifier="tappable" ng-click="insertCrowd(60, customPlaceName);dialog.hide()">
            60%
          </ons-list-item>
          <ons-list-item modifier="tappable" ng-click="insertCrowd(40, customPlaceName);dialog.hide()">
            40%
          </ons-list-item>
          <ons-list-item modifier="tappable" ng-click="insertCrowd(20, customPlaceName);dialog.hide()">
            20%
          </ons-list-item>
        </ons-list>
      </ons-dialog>
    </ons-template>
  </div>
</ons-page>
