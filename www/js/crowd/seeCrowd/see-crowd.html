<ons-page>
  <ons-toolbar>
    <div class="left">
      <ons-toolbar-button ng-click="menu.toggle()">
        <ons-icon icon="ion-navicon" size="28px" fixed-width="false"></ons-icon>
      </ons-toolbar-button>
    </div>
    <div class="center">{{$root.lang.MAIN_MENU.SEE_CROWD}}</div>
    <div class="right">
      <ons-toolbar-button ng-click="showInfo()">
        <ons-icon id="info" icon="ion-information-circled" style="font-size: 32px; width: 1em;"> </ons-icon>
      </ons-toolbar-button>
    </div>
  </ons-toolbar>

  <button ng-if="!crowds" class="refresh-button button button--quiet" ng-click="checkLocation()">{{$root.lang.SEE_CROWD_MENU.NO_LOCATION}}</button>

  <div ng-if="crowds === 'pending'" class="loading-gif-wrapper">
    <img class="loading-gif-inner" ng-src="img/loading.gif" />
  </div>

  <div ng-if="crowds && crowds !== 'pending'">
    <ons-tabbar>
      <ons-tab page="list.html" label="{{$root.lang.SEE_CROWD_MENU.LIST}}" icon="ion-android-list" active="true"></ons-tab>
      <ons-tab page="map.html" label="{{$root.lang.SEE_CROWD_MENU.MAP}}" icon="ion-earth"></ons-tab>
    </ons-tabbar>

    <ons-template id="list.html">

      <ons-navigator animation="slide" var="app.navi">

        <ons-page>
          <div class="navigation-bar">
            <div class="navigation-bar__center">
              <input ng-model="searchInput" ng-change="searchInputChange(searchInput)" type="text" class="search-input" style="width: 96%; margin: 6px auto 6px auto;" placeholder="{{$root.lang.SEE_CROWD_MENU.SEARCH}}" />
            </div>
          </div>

          <!-- <ons-pull-hook ng-action="loadCrowds(true, $done)" var="loader">
        <span ng-switch="loader.getCurrentState()">
          <span ng-switch-when="initial">
            <ons-icon size="35px" icon="ion-arrow-down-a"></ons-icon>{{$root.lang.SEE_CROWD_MENU.PULL_TO_REFRESH}}</span>
          <span ng-switch-when="preaction">
            <ons-icon size="35px" icon="ion-arrow-up-a"></ons-icon>{{$root.lang.SEE_CROWD_MENU.RELEASE_TO_REFRESH}}</span>
          <span ng-switch-when="action">
            <ons-icon size="35px" spin="true" icon="ion-load-d"></ons-icon>{{$root.lang.SEE_CROWD_MENU.LOADING}}</span>
        </span>
      </ons-pull-hook> -->
          <div ng-if="crowds.length > 0">
            <ons-list modifier="inset" class="crowd-items-header-inner">
              <ons-list-item>
                <ons-row>
                  <ons-col width="10%" style="text-align:center;">
                    {{$root.lang.SEE_CROWD_MENU.DATE}}
                  </ons-col>
                  <ons-col width="60%" style="padding-left:1em;">
                    {{$root.lang.SEE_CROWD_MENU.NAME}}
                  </ons-col>
                  <ons-col width="15%" style="text-align:center;">
                    {{$root.lang.SEE_CROWD_MENU.LAST_VALUE}}
                  </ons-col>
                  <ons-col width="15%" style="text-align:center;">
                    {{$root.lang.SEE_CROWD_MENU.AVERAGE_VALUE}}
                  </ons-col>
                </ons-row>
              </ons-list-item>
            </ons-list>
            <div class="crowd-items-content">
              <ons-list modifier="inset" ons-lazy-repeat="MyDelegate">
                <ons-list-item class="crowd-item" ng-click="selectPlaceBasedCrowd(item);">
                  <ons-row>
                    <ons-col width="10%" class="crowd-date">
                      {{item.lastUpdatePass}} {{$root.lang.SEE_CROWD_MENU.MIN_AGO}}
                    </ons-col>
                    <ons-col width="60%" class="crowd-name">
                      <img ng-src="img/sources/{{item.placeSource}}.png" /> {{item.placeName}}
                    </ons-col>
                    <ons-col width="15%" class="crowd-average-value">
                      <div class="c100 p{{item.crowdLast}} center orange custom">
                        <div class="slice">
                          <div class="bar"></div>
                          <div class="fill"></div>
                        </div>
                      </div>
                    </ons-col>
                    <ons-col width="15%" class="crowd-last-value">
                      <div class="c100 p{{item.crowdAverage}} center green custom">
                        <div class="slice">
                          <div class="bar"></div>
                          <div class="fill"></div>
                        </div>
                      </div>
                    </ons-col>
                  </ons-row>
                </ons-list-item>
              </ons-list>
            </div>
          </div>
          <button ng-if="crowds.length === 0" class="button button--quiet refresh-button" ui-sref="app.setCrowd">{{$root.lang.SEE_CROWD_MENU.NO_PLACE}}</button>
        </ons-page>
      </ons-navigator>
    </ons-template>
    <ons-template id="crowd-detail.html">
      <ons-page ng-controller="seeCrowdDetailDialogController">
        <ons-toolbar>
          <div class="left">
            <ons-back-button>Back</ons-back-button>
          </div>
          <div class="center">
            <img ng-src="img/sources/{{selectedPlaceBasedCrowd.placeSource}}.png" /> {{selectedPlaceBasedCrowd.placeName}}
          </div>
          <div class="right">
            <div class="c100 p{{selectedPlaceBasedCrowd.crowdAverage}} center green custom">
              <div class="slice">
                <div class="bar"></div>
                <div class="fill"></div>
              </div>
            </div>
          </div>
        </ons-toolbar>
        <ons-list>
          <ons-list-item ng-repeat="crowd in selectedPlaceBasedCrowd.crowds">
            <ons-row>
              <ons-col width="50%" class="crowd-last-value">
                {{crowd.lastUpdatePass}} {{$root.lang.SEE_CROWD_MENU.MIN_AGO}}
              </ons-col>
              <ons-col width="20%" class="crowd-last-value">
                <div class="c100 p{{crowd.crowdValue}} center green custom">
                  <div class="slice">
                    <div class="bar"></div>
                    <div class="fill"></div>
                  </div>
                </div>
              </ons-col>
              <ons-col width="15%">
                <ons-icon ng-if="crowd.isLast === true" icon="fa-thumbs-up" ng-click="givePositiveFeedback()"></ons-icon>
                <div ng-if="crowd.isLast !== true">{{crowd.crowdFeedback.positiveFeedback}}</div>
              </ons-col>
              <ons-col width="15%">
                <ons-icon ng-if="crowd.isLast === true" icon="fa-thumbs-o-down" ng-click="giveNegativeFeedback()"></ons-icon>
                <div ng-if="crowd.isLast !== true">{{crowd.crowdFeedback.negativeFeedback}}</div>
              </ons-col>
            </ons-row>
          </ons-list-item>
        </ons-list>
      </ons-page>
    </ons-template>
    <ons-template id="map.html">
      <ons-navigator animation="slide" var="app.navi">
        <div ng-controller="seeCrowdInMapController" id="map" style="width:100%; height:100%">
      </ons-navigator>
    </ons-template>
    </div>
</ons-page>
