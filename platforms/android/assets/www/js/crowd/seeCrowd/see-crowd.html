<ons-page>
  <ons-toolbar>
    <div class="left">
      <ons-toolbar-button ng-click="menu.toggle()">
        <ons-icon icon="ion-navicon" size="28px" fixed-width="false"></ons-icon>
      </ons-toolbar-button>
    </div>
    <div class="center">{{$root.lang.MAIN_MENU.SEE_CROWD}}</div>
  </ons-toolbar>

  <button ng-if="!crowds" class="refresh-button button button--quiet" ng-click="checkLocation()">{{$root.lang.SEE_CROWD_MENU.NO_LOCATION}}</button>

  <div ng-if="crowds === 'pending'" class="loading-gif-wrapper">
    <div class="loading-gif-inner">
      <div class="sp sp-wave"></div>
    </div>
  </div>

  <div ng-if="crowds && crowds !== 'pending'">
    <ons-tabbar>
      <ons-tab page="list.html" label="{{$root.lang.SEE_CROWD_MENU.LIST}}" icon="ion-android-list" active="true"></ons-tab>
      <ons-tab page="map.html" label="{{$root.lang.SEE_CROWD_MENU.MAP}}" icon="ion-earth"></ons-tab>
    </ons-tabbar>

    <ons-template id="list.html">
      <ons-pull-hook ng-action="loadCrowds(true, $done)" var="loader">
        <span ng-switch="loader.getCurrentState()">
          <span ng-switch-when="initial">
            <ons-icon size="35px" icon="ion-arrow-down-a"></ons-icon>{{$root.lang.SEE_CROWD_MENU.PULL_TO_REFRESH}}</span>
          <span ng-switch-when="preaction">
            <ons-icon size="35px" icon="ion-arrow-up-a"></ons-icon>{{$root.lang.SEE_CROWD_MENU.RELEASE_TO_REFRESH}}</span>
          <span ng-switch-when="action">
            <ons-icon size="35px" spin="true" icon="ion-load-d"></ons-icon>{{$root.lang.SEE_CROWD_MENU.LOADING}}</span>
        </span>
      </ons-pull-hook>
      <div ng-if="placeBasedCrowds && placeBasedCrowds.length > 0">
        <div class="crowd-items-header">
          <ons-list modifier="inset" class="crowd-items-header-inner">
            <ons-list-item>
              <ons-row>
                <ons-col width="10%" style="text-align:center;">
                  {{$root.lang.SEE_CROWD_MENU.DATE}}
                </ons-col>
                <ons-col width="60%" style="padding-left:1em;">
                  {{$root.lang.SEE_CROWD_MENU.NAME}}
                </ons-col>
                <ons-col width="15%" style="text-align:center;">
                  {{$root.lang.SEE_CROWD_MENU.LAST_VALUE}}
                </ons-col>
                <ons-col width="15%" style="text-align:center;">
                  {{$root.lang.SEE_CROWD_MENU.AVERAGE_VALUE}}
                </ons-col>
              </ons-row>
            </ons-list-item>
          </ons-list>
        </div>
        <div class="crowd-items-content">
          <ons-list modifier="inset">
            <ons-list-item class="crowd-item">
            </ons-list-item>
            <ons-list-item ng-repeat="placeBasedCrowd in placeBasedCrowds" class="crowd-item" ng-click="selectPlaceBasedCrowd(placeBasedCrowd);">
              <ons-row>
                <ons-col width="10%" class="crowd-date">
                  {{placeBasedCrowd.lastUpdatePass}} {{$root.lang.SEE_CROWD_MENU.MIN_AGO}}
                </ons-col>
                <ons-col width="60%" class="crowd-name">
                  <img width="15" height="15" src="img/sources/{{placeBasedCrowd.placeSource}}.png" /> {{placeBasedCrowd.placeName}}
                </ons-col>
                <ons-col width="15%" class="crowd-average-value">
                  <div class="c100 p{{placeBasedCrowd.crowdLast}} center orange custom">
                    <div class="slice">
                      <div class="bar"></div>
                      <div class="fill"></div>
                    </div>
                  </div>
                </ons-col>
                <ons-col width="15%" class="crowd-last-value">
                  <div class="c100 p{{placeBasedCrowd.crowdAverage}} center green custom">
                    <div class="slice">
                      <div class="bar"></div>
                      <div class="fill"></div>
                    </div>
                  </div>
                </ons-col>
              </ons-row>
            </ons-list-item>
          </ons-list>
        </div>
      </div>
      <button ng-if="!(placeBasedCrowds && placeBasedCrowds.length > 0)" class="button button--quiet refresh-button" ui-sref="app.setCrowd">{{$root.lang.SEE_CROWD_MENU.NO_PLACE}}</button>
    </ons-template>

    <ons-template id="tags.html">
      <ons-toolbar>
        <div class="center">Tags</div>
      </ons-toolbar>
    </ons-template>

    <ons-template id="crowd-detail.html">
      <ons-dialog var="dialog" cancelable ng-controller="seeCrowdDetailDialogController">
        {{selectedPlaceBasedCrowd.placeName}} {{selectedPlaceBasedCrowd.crowdAverage}}
      </ons-dialog>
    </ons-template>

    <ons-template id="map.html">
      <div ng-controller="seeCrowdInMapController" id="map" style="width:100%; height:100%">
    </ons-template>
    </div>
</ons-page>
